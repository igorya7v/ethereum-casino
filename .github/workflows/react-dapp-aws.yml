on:
  workflow_dispatch
  #release:
  #  types: [created]

name: Deploy to Amazon ECS

jobs:
    
  test_json:
    name: Test
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: Read from json file
      id: set_var
      run: |
        content=`cat ./backend/Casino.json`
        # the following lines are only required for multi line json
        content="${content//'%'/'%25'}"
        content="${content//$'\n'/'%0A'}"
        content="${content//$'\r'/'%0D'}"
        # end of optional handling for multi line json
        echo "::set-output name=packageJson::$content"
    
    - run: |
        echo "${{fromJson(steps.set_var.outputs.packageJson).networks}}"
        address="`jq '.networks."3".address' ./backend/Casino.json`"
        abi="`jq '.abi' ./backend/Casino.json`"
        echo $address
        echo "$abi" >abi_file
#        sed -i 's,<%address_placeholder%>,'"$address"',g' ./frontend/src/js/config.js
#        sed ':a;N;$!ba;s/\n/ /g' abi_file
#        abi=cat abi_file
#        sed -i "s|<%abi_placeholder%>|$abi|g" ./frontend/src/js/config.js
#        cat ./frontend/src/js/config.js
        
